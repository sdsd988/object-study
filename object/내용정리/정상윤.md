# 3장 : 역할, 책임, 협력

## 객체 지향 프로그래밍 
- 협력하는 객체들의 공동체를 창조하는 것
- 협력을 구성하기 위해 적절한 객체를 찾고, 적절한 책임을 할당하는 과정
- 애플리케이션 기능을 구형하기 위해 어떤 협력이 필요하고 협력을 위해 어떤 역할과 책임이 필요한지를 고민하는 것이 필요하다.


## 협력

#### 정의: 객체들이 애플리케이션 기능을 구현하기 위해 수행하는 상호작용

- 협력이 이루어지는 방식? - 메세지 전송
- 메시지 전송으로 협력이 구현되는 이유:`캡슐화`, 객체는 다른 객체의 상세한 내부 구현에 직접 접근할 수 없기 때문
- 메세지를 수신한 객체는 `메서드`를 활용해서 요청에 응답
  - 객체는 메세지를 선택할 방법을 스스로 선택, 즉 객체 내부에 구현된 `메서드`를 활용해서 메세지에 응답
- 영화 예매 시스템에서의 메시지 전송 과정
  - Screening 객체는 혼자서 요금 계산을 처리할 수 없다.
  - Movie 객체에게 요금 계산을 메세지(calculateMovieFee)를 전송(위임)
  - Movie 객체는 직접 요금을 계산(자율적인 존재)
- 자율적인 객체는 자신에게 할당된 책임을 수행하던 중에 필요한 정보를 알지 못하거나 외부의 도움이 필요한 경우 적절한 객체에게 메세지를 전송해서 협력을 요청
- 객체들 사이의 협력을 구성하는 일련의 요청과 응답의 흐름을 통해 애플리케이션 기능이 구현

### 협력이 설계를 위한 문맥을 결정한다 

#### 객체 - 상태와 행동을 함께 캡슐화하는 실행 단위

##### 협력 -> 행동 -> 상태

- 객체가 가질 수 있는 상태와 행동을 결정하는 근거, 어떤 상태와 행동을 할당하는 이유는? - 객체가 참여하고 있는 `협력`
- 협력은 객체가 필요한 이유와 객체가 수행하는 행동의 동기를 제공
- 영화 예매 시스템에서 상태와 행동을 할당한 과정
  - 일반적으로 Movie의 역할은 영화 상영과 관련된 행동을 가질 것으로 생각한다.
  - 하지만, 영화 예매 시스템 안의 객체 Movie는 영화 예매를 하기 위한 협력에 참여하고 있다.
  - 그리고, 그 안에서 요금을 계산하는 책임을 가지고 있다.
  - 즉, Movie의 행동을 결정하는 것은 `영화 예매를 위한 협력`
- 객체의 행동은 객체의 상태를 결정한다.
- 객체의 상태는 그 객체가 행동을 수행하는데 필요한 정보에 따라 결정
- 객체는 자율적인 존재이므로, 행동에 필요한 상태도 함께 가지고 있어야 함
  - Movie 객체는 행동(요금 계산)에 필요한 상태(기본요금(fee),할인정책(discountPolicy))를 포함한다.
  - Screening 객체는 행동(예매 요금 계산)에 필요한 상태(영화(Movie))를 가진다.
- 결론적으로, 협력은 객체를 설계하는데 필요한 문맥(Context)를 제공함으로써 객체의 상태와 행동 결정에 영향을 미친다.

## 책임
  
#### 책임: 협력에 참여하기 위해 객체가 수행하는 행동

- 객체에 의해 정의되는 응집도 있는 행위의 집합
- 객체가 유지해야 하는 정보와 수행할 수 있는 행동에 대해 개략적으로 서술한 문장
- '객체가 무엇을 알고 있는가'와 '객체가 무엇을 할 수 있는가' 즉 '하는 것(doing)과 아는 것(Knowing)'
- 하는 것 : 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것, 다른 객체의 행동을 시작 시키는 것, 다른 객체의 활동을 제어하고 조절하는 것
- 아는 것 : 사적인 정보에 관해 아는 것, 관련된 객체에 대해 아는 것, 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것
- 영화 예메 시스템에서의 책임
  - Screening(영화를 예매) - 영화를 예매한다(하는 것) + 상영할 영화를 알고 있다(아는 것)
  - Movie(요금을 계산) - 예매 가격을 계산한다(하는 것) + 가격과 할인 정책을 알고 있다(아는 것)
  - Screening 객체가 reserve 메세지를 수신하고 movie 객체를 인스턴스 변수로 포함하는 이유? - 영화 예매의 책임
  - Movie 객체가 calculateMovieFee 메세지를 수신할 수 있고 fee, discountPolicy 객체를 속성으로 가지는 이유는 - 예매 가격 계산의 책임
  - 책임의 정의는 메세지의 개념을 포함하고 있다. 책임의 관점에서 하는 것과 아는 것은 밀접하게 연관
  - 객체는 자신이 맡은 책임을 수행하는 데 필요한 정보를 알고 있어야 하고, 자신이 할 수 없는 작업을 도와줄(위임) 객체를 알고 있어야 한다.
  - 문맥(협력) -> 책임 

### 책임 할당

- 정보 전문가 패턴 : 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것
- 협력 설계 : 시스템이 사용자에게 제공하는 기능을 시스템이 담당할 하나의 책임으로 바라보는 것
- 영화 예매 시스템에서의 협력 설계
  - 시스템이 사용자에게 제공하는 기능(영화 예매)을 하나의 책임으로 할당
  - 책임을 수행하는 방법: 메세지를 전송, 책임을 할당하는 것은 메시지의 이름을 결정하는 것과 같음
  - 메세지 선택 - 객체 선택(정보 전문가 패턴) 예매와 관련된 정보를 가장 많이 알고 있는 Screening 객체 선택
  - 예매를 위해서는 계산이 필요하고, 이는 Movie 객체에 책임을 할당
  - Movie 객체는 가격 계산의 전문가이지만, 할인 요금 계산 메세지의 전문가는 아니기에 새로운 객체를 찾아서 책임을 할당해야 한다.
- 즉 객체지향 설계는 협력에 필요한 메세지를 찾고 이에 맞는 적절한 객체를 선택하는 반복적인 과정, 메세지가 수신할 객체의 책임을 결정
- 결정된 메세지는 객체의 퍼블릭 인터페이스를 구성


### 책임 주도 설계

- 정의: 책임을 찾고 책임을 수행할 적적할 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법
  - 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악
  - 시스템 책임을 더 작은 책임으로 분할
  - 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당
  - 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
  - 해당 객체 도는 역할에게 책음을 할당함으로써 두 객체가 협력
- 협력(문맥) -> 책임 -> 객체

### 메세지가 객체를 결정한다

- 문맥을 통해 필요한 책임(메세지)를 먼저 식별하고, 이를 식별할 객체를 선택하는 선후 관계가 중요함
- `메세지`가 `객체`를 결정하는 이유
  1. 객체가 최소한의 인터페이스를 가질 수 있게 된다. - 적합한 설계
  2. 객체는 충분히 추상적인 인터페이스를 가질 수 있게 된다. - 확장성이 높은 설계

### 행동이 상태를 결정한다

- 객체는 협력에 필요한 행동을 제공하는 것이 중요하다. 왜냐하면, 객체의 행동은 객체가 협력에 참여할 수 있는 유일한 방법이기 떄문
- 객체가 협력에 적합 여부를 판단하는 기준 - 객체의 행동
- 적절한 책임을 할당하고, 협력에 적절한지 여부를 판단해야 한다.
- 상태를 결정하고 행동을 결정하면 캡슐화를 저해할 수 있다.


## 역할

#### 정의 : 객체가 어떤 특정한 협력 안에서 수행하는 책임의 집합

#### 협력 -> 역할 -> 책임, 설계를 복잡하게 만드는 역할 개념을 도입하는 이유

- 역할을 통해 유연하고 재사용 가능한 협력을 얻는 것
- 영화 예매 시스템에서의 `역할`
  - Movie 객체에서 할인 요금을 계산하라 메세지에 따라 선택할 수 있는 객체는 비율 할인, 양적 할인 정책 객체 두가지가 있다.
  - 두 종류의 객체가 참여하는 협력을 개별적으로 만들어야 할 필요가 없다.
  - 왜냐하면, 두 객체의 `역할`이 같기 때문
- 역할은 여러 객체를 포괄하는 `추상화`를 통해 구현된다.
- 동일한 책임을 수행하는 역할을 기반으로 여러 협력을 하나로 통합할 수 있다.

### 객체 대 역할

- 역할에 대응되는 객체가 하나라면 굳이 역할이라고 간주할 필요없다. 
- 역할에 대응되는 객체가 N개일 경우, 역할로 정의하고 설계해 나가면 된다.
- 대부분의 경우 역할과 객체를 명확히 구분해 나가는 것은 힘들다.
- 저자는 설계 초반에는 적절한 책임과 협력의 큰 그림을 탐색하고, 개발을 진행나가며 객체와 역할을 분리해 나가는 것을 추천

### 역할과 추상화

- 추상화의 장점: 중요한 정책을 상위 수준에서 단순화, 설계의 유연성

### 배우와 배역

- 배우(객체)는 다양한 배역(역할)을 가질 수 있다.
- 배우가 연극안에서 여러 배역을 수행할 수 있듯, 객체는 협력안에서 여러 역할을 수행할 수 있다.
- 중요한 것은 특정한 협력에서는 오직 하나만의 역할을 수행해야 한다.
- 즉 객체는 다수의 역할을 보유할 수 있지만 객체가 참여하는 특정 협력은 객체의 한가지 역할만 바라볼 수 있다.
- 